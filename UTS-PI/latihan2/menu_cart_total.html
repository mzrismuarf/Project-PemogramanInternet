<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- stylesheet -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/menu.css">
    <!-- script.js -->
    <script type="text/javascript" src="js/script.js"></script>
    <!-- light-slider.css untuk card menu -->
    <link rel="stylesheet" href="css/lightslider.css">
    <!-- Jquery -->
    <script type="text/javascript" src="js/Jquery.js"></script>
    <!-- lightsliders.js -->
    <script type="text/javascript" src="js/lightslider.js"></script>
    <style>
        /* Add your styles for the cart here */
        #cart {
            position: fixed;
            top: 70px;
            right: -300px;
            width: 300px;
            height: 100%;
            /* background-color: #fff; */
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            transition: 0.3s;
            overflow-y: auto;
            padding: 20px;
            z-index: 1000;
        }

        #cart.active {
            right: 0;
        }

        #cart img {
            max-width: 100%;
            height: auto;
            margin-bottom: 10px;
        }

        .cart-item {
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .delete-btn {
            color: red;
            cursor: pointer;
        }

        .edit-btn {
            color: rgb(0, 255, 89);
            cursor: pointer;
        }
    </style>
</head>

<body>
    <header>
        <div class="logo">
            <img src="images/logo.png" alt="" width="100px">
            <h1>Sushi</h1>
        </div>
        <nav>
            <ul>
                <li><a href="/index.html" id="home">Home</a></li>
                <li><a href="/menu.html">Menu</a>
                    <ul class="dropdown">
                        <li><a href="/menu.html#lunch-menu">Lunch Menu</a></li>
                        <li><a href="/menu.html#dinner-menu">Dinner</a></li>
                        <li><a href="/menu.html#breakfast-menu">Breakfast</a></li>
                        <li><a href="/menu.html#catering-menu">Catering</a></li>
                    </ul>
                </li>
                <li><a href="/gallery.html">Gallery</a></li>
                <li><a href="/aboutous.html">About Us</a></li>
                <li><a href="#chart-btn">
                        <div class="btn-slider">
                            <button id="chart-btn" class=" btn-login">chart</button>
                        </div>
                    </a>
                </li>
            </ul>
        </nav>
    </header>
    <main>
        <section>
            <div id="cart">
                <!-- Cart content will be dynamically added here using JavaScript -->
                <div id="cart-items"></div>
                <button id="checkout-btn" onclick="redirectToOrderPage()">Checkout</button>
            </div>
            <div class="title-category" id="lunch-menu">
                <h1>Lunch menu</h1>
            </div>
            <div class="container-menu">
                <div class="container-menu-box">
                    <div class="box" id="item1">
                        <!-- img box -->
                        <div class="slide-img">
                            <img src="images/menu/Lunch/SushiComboA/4.jpg" alt="">
                            <!-- overlayer -->
                            <div class="overlay">
                                <a href="#" id="buynow" class="overlay-buy-btn">Buy Now</a>
                            </div>
                        </div>
                        <!-- detail box -->
                        <div class="detail-box">
                            <!-- rating -->
                            <div class="rating">
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star-half checked"></span>
                                <span class="fa fa-star"></span>
                            </div>
                            <!-- type-->
                            <div class="type">
                                <a href="#">Sushi Combo A</a>
                                <p>8 nigiri and 1 maki roll</p>
                            </div>
                            <!-- price -->
                            <a href="" class="price">Rp. 23.00</a>
                        </div>
                    </div>
                    <div class="box" id="item2">
                        <!-- img box -->
                        <div class="slide-img">
                            <img src="images/menu/Lunch/BentoBox/1.jpg" alt="">
                            <!-- overlayer -->
                            <div class="overlay">
                                <a href="#" id="buynow" class="overlay-buy-btn">Buy Now</a>
                            </div>
                        </div>
                        <!-- detail box -->
                        <div class="detail-box">
                            <!-- rating -->
                            <div class="rating">
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star-half checked"></span>
                                <span class="fa fa-star"></span>
                            </div>
                            <!-- type-->
                            <div class="type">
                                <a href="#">Bento Box</a>
                                <p>Assorted sushi, sashimi, tempura, and miso soup</p>
                            </div>
                            <!-- price -->
                            <a href="" class="price">Rp. 24.500</a>
                        </div>
                    </div>
                    <div class="box" id="item3">
                        <!-- img box -->
                        <div class="slide-img">
                            <img src="images/menu/Lunch/TeriyakiChickenDonburi/1.jpg" alt="">
                            <!-- overlayer -->
                            <div class="overlay">
                                <a href="#" id="buynow" class="overlay-buy-btn">Buy Now</a>
                            </div>
                        </div>
                        <!-- detail box -->
                        <div class="detail-box">
                            <!-- rating -->
                            <div class="rating">
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star-half checked"></span>
                                <span class="fa fa-star"></span>
                            </div>
                            <!-- type-->
                            <div class="type">
                                <a href="#">Teriyaki Chicken Donburi</a>
                                <p>Grilled teriyaki chicken served over a bowl of sushi rice</p>
                            </div>
                            <!-- price -->
                            <a href="" class="price">Rp. 25.000</a>
                        </div>
                    </div>
        </section>
    </main>
</body>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const buyNowButtons = document.querySelectorAll('.overlay-buy-btn');
        const cart = document.getElementById('cart');
        const cartItemsContainer = document.getElementById('cart-items');
        const chartBtn = document.getElementById('chart-btn');
        const checkoutBtn = document.getElementById('checkout-btn');
        let totalQty = 0;
        let totalPrice = 0;

        updateCheckoutButtonVisibility();
        checkoutBtn.style.display = 'none';

        chartBtn.addEventListener('click', function () {
            cart.classList.toggle('active'); // Tambahkan ini
        });



        buyNowButtons.forEach(function (button) {
            button.addEventListener('click', function (event) {
                event.preventDefault();

                const parentBox = event.target.closest('.box');
                const imgSrc = parentBox.querySelector('.slide-img img').src;
                const title = parentBox.querySelector('.type a').innerText;
                const existingCartItem = getCartItemByTitle(title);

                if (existingCartItem) {
                    const inputQty = prompt(`Item "${title}" sudah ada di keranjang. Masukkan jumlah tambahan:`);
                    if (inputQty !== null) {
                        const qty = parseInt(inputQty) || 0;
                        if (qty > 0) {
                            updateCartItemQty(existingCartItem, qty);
                        }
                    }
                } else {
                    const inputQty = prompt(`Masukkan jumlah item "${title}":`);
                    if (inputQty !== null) {
                        const qty = parseInt(inputQty) || 0;
                        if (qty > 0) {
                            const price = parseFloat(parentBox.querySelector('.price').innerText.replace('Rp. ', ''));
                            addToCart(imgSrc, title, qty, price);
                        }
                    }
                }
            });
        });


        function getCartItemByTitle(title) {
            const cartItems = document.querySelectorAll('.cart-item');
            for (const cartItem of cartItems) {
                if (cartItem.querySelector('p').innerText === title) {
                    return cartItem;
                }
            }
            return null;
            updateCheckoutButtonVisibility();
        }


        function updateCheckoutButtonVisibility() {
            const checkoutBtn = document.getElementById('checkout-btn');
            const cartItemsContainer = document.getElementById('cart-items');

            const totalQty = cartItemsContainer.children.length;
            console.log("Total Qty:", totalQty);

            checkoutBtn.style.display = totalQty > 0 ? 'block' : 'none';
        }




        function addToCart(imgSrc, title, qty, price) {
            console.log("Adding to cart:", title);
            console.log("Total Qty:", totalQty);
            const cartItem = document.createElement('div');
            cartItem.classList.add('cart-item');

            cartItem.innerHTML = `
            <img src="${imgSrc}" alt="${title}">
            <p>${title}</p>
            <p class="qty">Qty: ${qty}</p>
            <p class="price">Price: Rp. ${(qty * price).toFixed(2)}</p>
            <span class="edit-btn" onclick="editCartItem(this)">Edit</span>
            <span class="delete-btn" onclick="removeCartItem(this)">Delete</span>
        `;
            cartItem.dataset.qty = qty;
            cartItem.dataset.price = price;

            cartItemsContainer.appendChild(cartItem);
            cart.classList.add('active');

            updateCheckoutButtonVisibility();

            totalQty += qty;
            totalPrice += qty * price;
            updateCartTotal();



            console.log("Number of items in cart:", cartItemsContainer.children.length);
        }

        function updateCartTotal() {
            const cartTotal = document.getElementById('cart-total');
            cartTotal.innerHTML = `Total Qty: ${totalQty}<br>Total Price: Rp. ${totalPrice.toFixed(2)}`;
            // updateCheckoutButtonVisibility();
        }

        // ... (fungsi-fungsi lainnya)

        function updateCartItemQty(cartItem, qty) {
            const qtyElement = cartItem.querySelector('.qty');
            qtyElement.innerText = `Qty: ${qty}`;
            const price = parseFloat(cartItem.dataset.price);
            cartItem.querySelector('.price').innerText = `Price: Rp. ${(qty * price).toFixed(2)}`;
            cart.classList.add('active');

            totalQty += qty - parseInt(cartItem.dataset.qty);
            totalPrice += (qty - parseInt(cartItem.dataset.qty)) * price;
            updateCartTotal();
            cartItem.dataset.qty = qty;
            // updateCheckoutButtonVisibility();
        }

        // ... (fungsi-fungsi lainnya)
        function updateCartItemQty(cartItem, qty) {
            const qtyElement = cartItem.querySelector('.qty');
            qtyElement.innerText = `Qty: ${qty}`;

            const price = parseFloat(cartItem.dataset.price);
            const totalPriceForItem = qty * price;
            cartItem.querySelector('.price').innerText = `Price: Rp. ${totalPriceForItem.toFixed(2)}`;
            cart.classList.add('active');

            // Menghitung total qty dan total price secara keseluruhan
            totalQty = 0;
            totalPrice = 0;

            const cartItems = document.querySelectorAll('.cart-item');
            cartItems.forEach(function (item) {
                const itemQty = parseInt(item.dataset.qty);
                totalQty += itemQty;
                totalPrice += itemQty * parseFloat(item.dataset.price);
            });

            updateCartTotal();

            cartItem.dataset.qty = qty;
        }

        window.editCartItem = function (editBtn) {
            const cartItem = editBtn.closest('.cart-item');
            const title = cartItem.querySelector('p').innerText;
            const inputQty = prompt(`Edit jumlah item "${title}":`, cartItem.dataset.qty);
            const qty = inputQty ? parseInt(inputQty) : parseInt(cartItem.dataset.qty);

            if (qty > 0) {
                updateCartItemQty(cartItem, qty);
            } else {
                removeCartItem(cartItem);
            }

            // updateCheckoutButtonVisibility();
        };


        window.removeCartItem = function (deleteBtn) {
            const cartItem = deleteBtn.closest('.cart-item');
            cartItem.remove();

            const cartItems = document.querySelectorAll('.cart-item');
            if (cartItems.length === 0) {
                cart.classList.remove('active');
            }
            updateCheckoutButtonVisibility(); // Memanggil fungsi setelah menghapus item
        };

        window.redirectToOrderPage = function () {
            const orderData = [];

            const cartItems = document.querySelectorAll('.cart-item');
            cartItems.forEach(function (cartItem) {
                const title = cartItem.querySelector('p').innerText;
                const qty = parseInt(cartItem.dataset.qty);
                const price = parseFloat(cartItem.dataset.price);

                orderData.push({ title, qty, price });
            });

            // updateCheckoutButtonVisibility();

            localStorage.setItem('orderData', JSON.stringify(orderData));
            localStorage.setItem('orderTotalQty', totalQty);
            localStorage.setItem('orderTotalPrice', totalPrice.toFixed(2));
            window.location.href = 'order.html';
        };

        // minimaze

        // end
    });
</script>

</html>